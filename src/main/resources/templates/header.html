<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

<nav class="navbar navbar-default" th:fragment="header">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="/inicial" style="font-size: 25px">WIKIDRINKS</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav" th:if="${loggedUser != null}">
	            <li th:classappend="${pantallaActual == 'home' ? 'active' : ''}">
	            	<a href="/inicial">Home</a>
	            </li>
	            <li th:classappend="${pantallaActual == 'misTragos' ? 'active' : ''}">
	            	<a href="/inicial">Mis Tragos</a>
	            </li>
	            <li th:classappend="${pantallaActual == 'presupuesto' ? 'active' : ''}">
	            	<a href="/inicial">Presupuestos</a>
	            </li>
            </ul>
            <ul class="nav navbar-nav" th:if="${loggedUser == null}">
	            <li class="active" th:if="${pantallaActual == 'registro'}">
	            	<a href="/inicial">Registro</a>
	            </li>
            </ul>
	        <form id="formLogin">
            <ul class="nav navbar-nav navbar-right" th:if="${loggedUser == null}">
                <li>
                    <a href="#" onclick="registrarse();">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>&nbsp;Registrarse
                    </a>
                </li>
                <li class="dropdown">
		        	<a href="#" class="dropdown-toggle" onclick="mostrarLogin()" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-log-in" aria-hidden="true"></span>&nbsp;Log in</a>
	          		<ul class="dropdown-menu" id="dropdownLogin" style="display: none">
			            <li class="col-xs-12"><label>USUARIO/EMAIL</label></li>
			            <li class="col-xs-12 form-group"><input type="text" name="userMail"/></li>
			            <li class="col-xs-12"><label>CONTRASEÑA</label></li>
			            <li class="col-xs-12 form-group"><input type="password" name="pass"/></li>
			            <li style="text-align: center"><span onclick="logIn()" class="btn btn-primary">Iniciar sesión</span></li>
		          	</ul>
                </li>
            </ul>
			</form>
            <ul class="nav navbar-nav navbar-right" th:if="${loggedUser != null}">
                <li>
                    <a href="#" onclick="mostrarPerfil();">
                   		<i class="fa fa-user-circle-o"></i>
                  		<span th:text="${loggedUser.username}"></span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="logOut();">
                        Log Out&nbsp;<span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>&nbsp;
                    </a>
                </li>
               </ul>
        </div>
    </div>
</nav>

<script>
function mostrarLogin(){
	$("#dropdownLogin").show();
}

function registrarse(){
	window.location.href = "http://localhost:8080/registro";
}

function logIn(){
	$.ajax({
	    type: 'POST',
	    url: "/validar-login",
	    data: $("#formLogin").serialize(),
	    success: function (data) {
	    	if(data == "OK"){
	    		window.location.href = "http://localhost:8080/inicial";
// 	    		$.ajax({
// 				    type: 'POST',
// 				    url: "/loguear-usuario/",
// 					data: $("#form").serialize(),
// 				    success: function (user) {
// 			    		sessionStorage.setItem("loggedUser", user);
// 				    }
// 				});
	    	}else{
	    		alert(data);
	    	}
	    }
	});
}

function logOut(){
	$.ajax({
	    type: 'POST',
	    url: "/logout/",
	    success: function (data) {
	    	if(data == "OK"){
	    		window.location.href = "http://localhost:8080/login";
	    	}
	    }
	});
}

</script>

<style>
.container-fluid a{
	font-family: cursive;font-size: 15px
	}
</style>
