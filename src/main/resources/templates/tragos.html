<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<div th:replace="cssYJs"></div>	
	<title>Wikidrinks - Tragos</title>
</head>
<body>
	<div th:replace="header"></div>
	<h2 class="col-xs-12" style="text-align: center;">TRAGOS</h2>
	<div id="divFiltrar" class="panel panel-default col-xs-12" style="font-size: 20px">
		<div class="panel-body col-xs-12">
			<div class="col-xs-12 form-group">
				<form id="formFiltro">
					Nombre: 
					<input type="text" name="nombre" />
					Graduación mínima:
					<input type="text" name="grad"/>
					Puntuación mínima:
					<input type="text" name="punt"/>
				</form>
			</div>
			<div class="col-xs-2">
				<span onclick="volverHome()" class="btn btn-primary col-xs-10"> Volver</span>
				
			</div>
			<div class="col-md-6 col-md-offset-4">
				<button th:if="${loggedUser}" type="button" class="btn btn-primary col-xs-6 col-md-3" data-toggle="modal" data-target="#nuevoTragoModal" style="margin-right: 10px">
					Nuevo Trago
					<i class="fa fa-glass"></i>
				</button>
				<span onclick="listar();" class="btn btn-primary col-xs-6 col-md-3">Filtrar</span>
			</div>
		</div>
	</div>
	<div id="tablaTragos" class="col-xs-12"></div>
	<div class="modal fade" id="nuevoTragoModal" tabindex="-1" role="dialog" aria-labelledby="nuevoTragoModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <label class="modal-title" id="exampleModalLabel">Nuevo trago</label>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body" style="font-size: 15px; float: right;">
	     	 <form id="formTrago">
	     	 <div class="col-xs-12 form-group">
				<label class="col-xs-4">Nombre:</label> 
				<input type="text" name="nombre" style="float: left" required="required"/>
				<input type="checkbox" name="deAutor" style="float: left;margin-left: 10px;"/>
				<label class="col-xs-3">Trago de autor</label> 
	     	 </div>
	     	 <div class="col-xs-12 form-group">
				<label class="col-xs-4">Vaso recomendado:</label>
				<input type="text" name="vaso" required="required"/>
	     	 </div>
	     	 <div class="col-xs-12 form-group">
				<label class="col-xs-4">Graduación:</label>
				<input type="number" name="graduacion" required="required"/>
	     	 </div>
	     	 <div class="col-xs-12 form-group">
				<label class="col-xs-3">URL imagen:</label>
				<input class="col-xs-9" type="text" name="urlImagen"/>
	     	 </div>
	     	 <div id="divIng1" class="col-xs-12 form-group">
				<label class="col-xs-3">Ingrediente 1:</label>
				<input class="col-xs-3" type="text" name="ing1" required="required"/>
				<label class="col-xs-2">Medida:</label>
				<input class="col-xs-2" type="number" name="medIng1" required="required"/>
				<i id="i1" onclick="mostrarDivIng(2)" style="font-size: 25px; margin-left: 10px; cursor: pointer;" class="fa fa-plus-circle"></i>
	     	 </div>
	     	 <div id="divIng2" class="col-xs-12 form-group" style="display: none">
				<label class="col-xs-3">Ingrediente 2:</label>
				<input class="col-xs-3" type="text" name="ing2" id="ing2"/>
				<label class="col-xs-2">Medida:</label>
				<input class="col-xs-2" type="number" name="medIng2" id="medIng2"/>
				<i onclick="eliminarIng(2)" style="font-size: 25px; margin-left: 10px; cursor: pointer; color: red" class="fa fa-minus-circle"></i>
				<i id="i2" onclick="mostrarDivIng(3)" style="font-size: 25px; margin-left: 10px; cursor: pointer;" class="fa fa-plus-circle"></i>
	     	 </div>
	     	 <div id="divIng3" class="col-xs-12 form-group" style="display: none">
				<label class="col-xs-3">Ingrediente 3:</label>
				<input class="col-xs-3" type="text" name="ing3" id="ing3"/>
				<label class="col-xs-2">Medida:</label>
				<input class="col-xs-2" type="number" name="medIng3" id="medIng3"/>
				<i onclick="eliminarIng(3)" style="font-size: 25px; margin-left: 10px; cursor: pointer; color: red" class="fa fa-minus-circle"></i>
				<i id="i3" onclick="mostrarDivIng(4)" style="font-size: 25px; margin-left: 10px; cursor: pointer;" class="fa fa-plus-circle"></i>
	     	 </div>
	     	 <div id="divIng4" class="col-xs-12 form-group" style="display: none">
				<label class="col-xs-3">Ingrediente 4:</label>
				<input class="col-xs-3" type="text" name="ing4" id="ing4"/>
				<label class="col-xs-2">Medida:</label>
				<input class="col-xs-2" type="number" name="medIng4" id="medIng4"/>
				<i onclick="eliminarIng(4)" style="font-size: 25px; margin-left: 10px; cursor: pointer; color: red" class="fa fa-minus-circle"></i>
				<i id="i4" onclick="mostrarDivIng(5)" style="font-size: 25px; margin-left: 10px; cursor: pointer;" class="fa fa-plus-circle"></i>
	     	 </div>
	     	 <div id="divIng5" class="col-xs-12 form-group" style="display: none">
				<label class="col-xs-3">Ingrediente 5:</label>
				<input class="col-xs-3" type="text" name="ing5" id="ing5"/>
				<label class="col-xs-2">Medida:</label>
				<input class="col-xs-2" type="number" name="medIng5" id="medIng5"/>
				<i onclick="eliminarIng(5)" style="font-size: 25px; margin-left: 10px; cursor: pointer; color: red" class="fa fa-minus-circle"></i>
				<i id="i5" onclick="mostrarDivIng(6)" style="font-size: 25px; margin-left: 10px; cursor: pointer;" class="fa fa-plus-circle"></i>
	     	 </div>
	     	 <div id="divIng6" class="col-xs-12 form-group" style="display: none">
				<label class="col-xs-3">Ingrediente 6:</label>
				<input class="col-xs-3" type="text" name="ing6" id="ing6"/>
				<label class="col-xs-2">Medida:</label>
				<input class="col-xs-2" type="number" name="medIng6" id="medIng6"/>
				<i onclick="eliminarIng(6)" style="font-size: 25px; margin-left: 10px; cursor: pointer; color: red" class="fa fa-minus-circle"></i>
				<i id="i6" onclick="mostrarDivIng(7)" style="font-size: 25px; margin-left: 10px; cursor: pointer;" class="fa fa-plus-circle"></i>
	     	 </div>
	     	 <div id="divIng7" class="col-xs-12 form-group" style="display: none">
				<label class="col-xs-3">Ingrediente 7:</label>
				<input class="col-xs-3" type="text" name="ing7" id="ing7"/>
				<label class="col-xs-2">Medida:</label>
				<input class="col-xs-2" type="number" name="medIng7" id="medIng7"/>
				<i id="i7" onclick="eliminarIng(7)" style="font-size: 25px; margin-left: 10px; cursor: pointer; color: red" class="fa fa-minus-circle"></i>
	     	 </div>
			</form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
	        <button type="button" class="btn btn-primary" onclick="crearTrago();">Crear trago</button>
	      </div>
	    </div>
	  </div>
	</div>
</body>

<script type="text/javascript">
	listar();
	$.validator.messages.required = "Este campo es requerido";
	function listar(){
		$.ajax({
		    type: 'POST',
			data: $("#formFiltro").serialize(),
		    url: "/listar-tragos",
		    success: function (data) {
		       $('#tablaTragos').html(data);
		    }
		});
	}
	
	function crearTrago(){
		if($("#formTrago").valid()){
			var formJqObj = $("#formTrago");
		    var formDataObj = {};
		    (function(){
		        formJqObj.find(":input").not("[type='submit']").not("[type='reset']").each(function(){
		            var thisInput = $(this);
		            formDataObj[thisInput.attr("name")] = thisInput.val();
		        });
		    })();
			
			$.ajax({
			    type: 'POST',
			    url: "/crear-trago/",
			    contentType: "application/json",
			    data: JSON.stringify(formDataObj),
			    success: function (data) {
			    	alert("Trago creado correctamente");
			    	location.reload();
			    }
			});
		}
	}
	function volverHome(){
		window.location = 'http://localhost:8080/inicial';
	}
	
	function mostrarDivIng(id){
		$("#divIng"+id).show();
		var i = id-1;
		$("#i"+i).hide();
		$("#ing"+id).prop('disabled', false);
		$("#medIng"+id).prop('disabled', false);
		
	}
	function eliminarIng(id){
		$("#divIng"+id).hide();
		var i = id-1;
		$("#i"+i).show();
		$("#ing"+id).prop('disabled', true);
		$("#medIng"+id).prop('disabled', true);
	}
	
</script>
<style>
	#divFiltrar .btn{
		font-size: 17px;
	}
	.error{
		color:red;
	}
</style>
</html>